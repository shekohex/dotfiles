# macOS (Darwin) to NixOS (Workstation) Feature Migration Plan

## Overview
This plan identifies features from macOS that should be added to the NixOS workstation, using only nixpkgs packages (no Homebrew). Based on user feedback, we're excluding messaging apps, macOS-specific tools, and Microsoft Office.

---

## 1. GUI Applications to Add

### From nixpkgs (Install in `hosts/workstation/home.nix`)

| Package | Attribute | Purpose |
|---------|-----------|---------|
| VLC | `pkgs.vlc` | Media player |
| Proton Pass | `pkgs.proton-pass` | Password manager |
| Proton Drive | `pkgs.proton-drive` | Cloud storage |

**Note:** Proton VPN GUI and CLI already installed at `hosts/workstation/home.nix:23-24`

### Already Present on Workstation
- ✅ Proton VPN GUI/CLI
- ✅ Proton Mail Desktop
- ✅ Syncthing (as service)
- ✅ wakatime-cli (line 34)
- ✅ harper (line 35)

---

## 2. CLI Tools to Add from nixpkgs

Add these to `hosts/workstation/default.nix` in `environment.systemPackages` or `hosts/workstation/home.nix`:

| Package | Nixpkgs Attribute | Purpose |
|---------|-------------------|---------|
| mise | `pkgs.mise` | Polyglot version manager (asdf alternative) |
| OpenJDK | `pkgs.openjdk` or `pkgs.openjdk21` | Java development kit |
| .NET SDK | `pkgs.dotnet-sdk` | .NET development |
| Ruby | `pkgs.ruby` | Ruby language |
| CocoaPods | `pkgs.cocoapods` | iOS dependency manager |
| Wake-on-LAN | `pkgs.wakeonlan` | Network wake utility |
| Eternal Terminal | `pkgs.eternal-terminal` | Persistent SSH sessions |
| ntfy | `pkgs.ntfy` | Push notifications |
| tea | `pkgs.tea` | Package manager |
| pgcli | `pkgs.pgcli` | PostgreSQL CLI with autocomplete |
| Terraform | `pkgs.terraform` | Infrastructure as code |
| Coder | `pkgs.coder` | Remote development environments |
| bd | `pkgs.bd` | Quick directory navigation |
| Bun | `pkgs.bun` | JavaScript runtime |

### Notes:
- **Tailscale**: Already installed as system service in `hosts/workstation/default.nix:37`
- **Harper**: Already in `hosts/workstation/home.nix:35` (grammar checker)
- **harper** appears to be the grammar checker (not HarperDB)

---

## 3. Window Manager Addition: Niri (alongside GNOME)

**Goal:** Add Niri as an additional window manager, keeping GNOME installed but making Niri the default.

Niri is a scrollable-tiling Wayland compositor. See: https://github.com/YaLTeR/niri

### Implementation Steps:

#### 3.1 Create Niri Module Structure
```
modules/wm/niri/
├── default.nix          # System-level configuration
└── home.nix             # User-level Home Manager configuration
```

#### 3.2 System Configuration (`modules/wm/niri/default.nix`)
- Enable Niri display manager session (adds to GDM sessions)
- Configure GDM to show both GNOME and Niri sessions
- Set up basic input/libinput configuration
- Enable XDG portal for Wayland
- Install essential Wayland tools:
  - `pkgs.waybar` or `pkgs.eww` (status bar)
  - `pkgs.mako` or `pkgs.dunst` (notifications)
  - `pkgs.wofi` or `pkgs.fuzzel` (launcher)
  - `pkgs.wl-clipboard` (clipboard)
  - `pkgs.grim` + `pkgs.slurp` (screenshots)
  - `pkgs.brightnessctl` (brightness control)
  - `pkgs.pamixer` or `pkgs.pulseaudio` (volume control)

#### 3.3 Home Manager Configuration (`modules/wm/niri/home.nix`)
- Configure Niri settings (keyboard, outputs, workspaces)
- Set up keybindings matching AeroSpace layout:
  - 9 workspaces (Browser=1, Code=2, Terminal=3, etc.)
  - Auto-routing apps to workspaces
  - Window rules and layouts
- Configure status bar (Waybar)
- Set up notification daemon
- Configure application launcher
- GTK/Qt theming for Wayland (shared with GNOME)

#### 3.4 Migration Path
1. Create `modules/wm/niri/` directory with default.nix and home.nix
2. Update `hosts/workstation/default.nix`:
   - ADD `(import ../../modules/wm/niri/default.nix)` alongside existing GNOME import
   - Keep GNOME module import unchanged
   - GDM will show both sessions; user can select Niri as default
3. Update `hosts/workstation/home.nix`:
   - ADD `(import ../../modules/wm/niri/home.nix)` alongside GNOME imports
   - Both configurations will be available
   - Niri config will only apply when logged into Niri session

**GNOME will remain installed and available as an alternative session in GDM.**

### Niri Package Availability:
- Niri is available in nixpkgs as `pkgs.niri`
- Home Manager has Niri module support

---

## 4. Excluded Items (Per User Feedback)

The following will NOT be added:

### Apps (Not Needed)
- ❌ WhatsApp Beta
- ❌ Signal Desktop  
- ❌ JetBrains Toolbox (use nixpkgs alternatives)
- ❌ OrbStack (Docker already installed)
- ❌ Android File Transfer (N/A on Linux)
- ❌ Xcode (macOS only)
- ❌ Raycast (macOS only)
- ❌ Microsoft Office
- ❌ The Unarchiver
- ❌ LocalSend
- ❌ Brave Browser
- ❌ Tor Browser

### Settings (macOS-Specific)
- ❌ Dock configuration
- ❌ Finder settings
- ❌ Trackpad tap-to-click (handle via libinput)
- ❌ Menu bar hiding
- ❌ macOS-specific key repeat settings

---

## 5. Files to Modify

### Primary Changes:

1. **`hosts/workstation/home.nix`**
   - Add: VLC, Proton Pass, Proton Drive
   - Add Niri home import alongside existing GNOME imports (keep GNOME)

2. **`hosts/workstation/default.nix`**
   - Add CLI tools to `environment.systemPackages`
   - Add Niri system import alongside existing GNOME import (keep GNOME)
   - Keep all GNOME-specific services unchanged

3. **Create `modules/wm/niri/default.nix`**
   - System-level Niri configuration
   - Wayland setup
   - Display manager session registration

4. **Create `modules/wm/niri/home.nix`**
   - Niri window manager configuration
   - Workspace and keybinding setup
   - Status bar, notifications, launcher

### New Files to Create:
- `modules/wm/niri/default.nix`
- `modules/wm/niri/home.nix`
- Potentially: `modules/wm/niri/waybar-config.nix` (status bar config)

---

## 6. Implementation Order

### Phase 1: Add Missing Packages (Quick Win)
1. Add VLC, Proton Pass, Proton Drive to `hosts/workstation/home.nix`
2. Add CLI tools to `hosts/workstation/default.nix`

### Phase 2: Window Manager Addition (Major Change)
1. Create Niri module structure
2. Configure basic Niri with 9 workspaces
3. Set up Wayland ecosystem (Waybar, notifications, launcher)
4. Migrate keybindings from AeroSpace layout
5. Test and validate
6. Add Niri to workstation alongside GNOME (both available in GDM)

---

## 7. Verification Steps

After implementation:
1. Run `nix flake check` to validate configuration
2. Build with `sudo nixos-rebuild build --flake .#workstation`
3. Verify all new packages are available
4. Test Niri window manager functionality
5. Confirm workspace switching and app routing works

---

## Summary

**Packages to Add:**
- 3 GUI apps (VLC, Proton Pass, Proton Drive)
- ~14 CLI tools (mise, openjdk, dotnet, ruby, cocoapods, wakeonlan, eternal-terminal, ntfy, tea, pgcli, terraform, coder, bd, bun)

**Major Change:**
- Add Niri window manager alongside existing GNOME
- Migrate AeroSpace workspace configuration to Niri
- GNOME remains available as alternative session in GDM

**Excluded:**
- All macOS-specific apps and settings
- Communication apps (WhatsApp, Signal)
- Browsers (Brave, Tor)
- Office tools (Raycast, Microsoft Office)
